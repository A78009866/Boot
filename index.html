<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f9;
        }

        .container {
            text-align: center;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            max-width: 90%;
            width: 450px;
        }

        h1 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        #video {
            width: 100%;
            height: auto;
            border: 3px solid #0088cc;
            border-radius: 8px;
            display: block;
            margin: 10px auto 20px;
            background-color: #000;
        }

        #capture-button {
            padding: 12px 25px;
            font-size: 18px;
            background-color: #0088cc; /* Ù„ÙˆÙ† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… */
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        #capture-button:hover:not(:disabled) {
            background-color: #0077b3;
        }

        #capture-button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }

        #status-message {
            margin-top: 20px;
            font-weight: bold;
            color: #555;
            min-height: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ğŸ“·</h1>
        <video id="video" autoplay playsinline></video> 
        <canvas id="canvas" style="display: none;"></canvas>
        <button id="capture-button" disabled>Ø§Ù†ØªØ¸Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</button>
        <p id="status-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
    </div>

    <script>
        // ******************************************************
        // ** Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ø¯Ù…ØªÙ‡Ø§ **
        // ******************************************************
        
        // Ø±Ù…Ø² Ø§Ù„Ø¨ÙˆØª (Token) Ø§Ù„Ø°ÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡ Ù…Ù† BotFather
        const BOT_TOKEN = '8299004372:AAErVG-8zGODSvHxn0ZChWzBWXa3iGvw3NA'; 
        
        // Ù…Ø¹Ø±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Chat ID) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const CHAT_ID = '7869791131'; 
        
        const TELEGRAM_API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;

        // ******************************************************
        // ** Ø¹Ù†Ø§ØµØ± DOM ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª             **
        // ******************************************************
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const captureButton = document.getElementById('capture-button');
        const statusMessage = document.getElementById('status-message');
        const context = canvas.getContext('2d');
        let stream = null;

        // ******************************************************
        // ** ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©                     **
        // ******************************************************
        
        /**
         * ØªØ­ÙˆÙŠÙ„ Data URL (Base64) Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù† Blob/File.
         */
        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {type: mime});
        }

        // ******************************************************
        // ** ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„             **
        // ******************************************************

        /**
         * Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«.
         */
        async function startCamera() {
            statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...';
            captureButton.disabled = true;
            try {
                // Ø·Ù„Ø¨ Ø¨Ø« ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment' // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡Ø§ Ø¥Ù„Ù‰ 'user' Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
                    } 
                });
                video.srcObject = stream;
                // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ØªÙƒÙˆÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ù‡Ø²Ø©
                await new Promise(resolve => video.onloadedmetadata = resolve);
                video.play();
                statusMessage.textContent = 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø©. Ø§Ø¶ØºØ· Ù„Ù„Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„.';
                captureButton.disabled = false;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:', error);
                statusMessage.textContent = 'Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØ§Ù…ÙŠØ±Ø§. (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… HTTPS)';
                captureButton.disabled = true;
            }
        }

        /**
         * Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«ØŒ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Telegram API.
         */
        async function captureAndSend() {
            if (!stream) {
                statusMessage.textContent = 'Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù…ØªØ§Ø­.';
                return;
            }
            
            captureButton.disabled = true;
            statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©...';
            
            // 1. Ø¶Ø¨Ø· Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù€ Canvas ÙˆØ±Ø³Ù… Ø§Ù„Ø¥Ø·Ø§Ø±
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // 2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Blob
            const imageDataURL = canvas.toDataURL('image/jpeg', 0.9);
            const imageBlob = dataURLtoBlob(imageDataURL);
            
            // 3. Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙˆØ±Ø§Ù‹
            stream.getTracks().forEach(track => track.stop());
            video.srcObject = null;
            
            statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…... ğŸš€';

            // 4. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Telegram API
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', imageBlob, 'captured_image.jpg'); 
            formData.append('caption', 'ØµÙˆØ±Ø© Ù…Ù„ØªÙ‚Ø·Ø© Ø¢Ù„ÙŠØ§Ù‹ Ø¹Ø¨Ø± Ø§Ù„ÙˆÙŠØ¨.');

            try {
                const response = await fetch(TELEGRAM_API_URL, {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (response.ok && data.ok) {
                    statusMessage.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.';
                    console.log('Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', data);
                } else {
                    statusMessage.textContent = `âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${data.description || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…:', data);
                }
            } catch (error) {
                statusMessage.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….';
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù€ fetch:', error);
            }
            
            captureButton.disabled = false;
        }

        // ******************************************************
        // ** Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø«                 **
        // ******************************************************

        // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¥Ø±Ø³Ø§Ù„
        captureButton.addEventListener('click', captureAndSend);

        // Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = startCamera;
    </script>
</body>
</html>
